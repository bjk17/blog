<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="//blog.bjk.is/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="//blog.bjk.is/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="//blog.bjk.is/theme/font-awesome/css/font-awesome.min.css">


    <link href="//blog.bjk.is/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Bjarni Jens's blog Atom">



  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Bjarni Jens Kristinsson" />
<meta name="description" content="I chose to download and install Ubuntu Desktop 16.04 as there is no difference in the kernel versions and I needed the graphical DE anyway. The installation process is really easy and straight-forward. I chose to use the whole mSATA SSD under the OS with default LVM configuration. I ..." />
<meta name="keywords" content="DevOps, infrastructure, Ubuntu, monitoring, netdata">
<meta property="og:site_name" content="Bjarni Jens's blog"/>
<meta property="og:title" content="Server version 0.1 -- OS and monitoring"/>
<meta property="og:description" content="I chose to download and install Ubuntu Desktop 16.04 as there is no difference in the kernel versions and I needed the graphical DE anyway. The installation process is really easy and straight-forward. I chose to use the whole mSATA SSD under the OS with default LVM configuration. I ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="//blog.bjk.is/server-version-01-os-and-monitoring.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-05-29 00:00:00+00:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="//blog.bjk.is/author/bjarni-jens-kristinsson.html">
<meta property="article:section" content="my NUC as a server"/>
<meta property="article:tag" content="DevOps"/>
<meta property="article:tag" content="infrastructure"/>
<meta property="article:tag" content="Ubuntu"/>
<meta property="article:tag" content="monitoring"/>
<meta property="article:tag" content="netdata"/>
<meta property="og:image" content="/static/bjk17.jpg ">
  <title>Bjarni Jens's blog &ndash; Server version 0.1 -- OS and monitoring</title>
</head>
<body>
  <aside>
    <div>
      <a href="//blog.bjk.is">
        <img src="/static/bjk17.jpg " alt="blog.bjk.is" title="blog.bjk.is">
      </a>
      <h1><a href="//blog.bjk.is">blog.bjk.is</a></h1>
<p>servers, networks, infrastructure, programming and mathematics</p>      <nav>
        <ul class="list">
          <li><a href="https://bjk.is/" target="_blank">bjk.is</a></li>
          <li><a href="http://bio.bjk.is/" target="_blank">bio.bjk.is</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-facebook" href="https://facebook.com/bjarni.jens" target="_blank"><i class="fa fa-facebook"></i></a></li>
        <li><a class="sc-linkedin" href="https://linkedin.com/in/bjk17" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://github.com/bjk17" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-envelope-o" href="mailto:bjarni.jens@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="//blog.bjk.is">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="//blog.bjk.is/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h1 id="server-version-01-os-and-monitoring">Server version 0.1 -- OS and monitoring</h1>
    <p>Posted on Sun 29 May 2016 in <a href="//blog.bjk.is/category/my-nuc-as-a-server.html">my NUC as a server</a></p>
  </header>
  <div>
    <p>I chose to download and install Ubuntu Desktop 16.04 as there is no difference in the kernel versions and I needed the graphical DE anyway.</p>
<p>The installation process is really easy and straight-forward. I chose to use the whole mSATA SSD under the OS with default <a href="https://wiki.ubuntu.com/Lvm">LVM</a> configuration. I did not choose full disk encryption this time because there are problems with remote reboots (you have to enter the encryption key at startup) but there are <a href="https://benediktkr.github.io/ops/2015/05/01/remote-fde.html">workarounds</a> that I might look into later.</p>
<h3>Configuring the HDD</h3>
<p>The 2TB HDD was formatted with ext4 from previous installation (when I used the NUC as a desktop PC) and it is packed with various data such as media and backups. I really doubt that ext4 is the best filesystem for this kind of media as I have considerable less space available than on my identical 2TB external hard drive that is formatted with NTFS.</p>
<p>I mount the HDD under <code>/hdd</code> and configure it to spin down after 5 minutes of inactivity to save power and reduce background noise. I really don't care about the extra 2-3 seconds of spin-up time for the rare times when I access data on the disk. By running <code>sudo blkid</code> I found out that the UUID of my partition on the HDD is <code>83652517-02c7-438d-9fad-35469c3a17b8</code> (it's <a href="https://help.ubuntu.com/community/UsingUUID">more reliable to use UUIDs</a> in Linux then <code>/dev/sdXY</code> addresses as they may change). </p>
<p>To achieve all this I ran</p>
<div class="highlight"><pre><span></span><span class="c1">## Find your UUID by running sudo blkid</span>
<span class="nv">HDD_UUID</span><span class="o">=</span><span class="s2">&quot;83652517-02c7-438d-9fad-35469c3a17b8&quot;</span>

<span class="c1">## Mounting the HDD under /hdd and making it permanent</span>
sudo mkdir /hdd
sudo chown bjarni:bjarni /hdd
<span class="nb">echo</span> <span class="s2">&quot;UUID=</span><span class="si">${</span><span class="nv">HDD_UUID</span><span class="si">}</span><span class="s2"> /hdd ext4 defaults 0 2&quot;</span> <span class="p">|</span> sudo tee -a /etc/fstab
sudo mount -a

<span class="c1">## Setting spindown time to 60*5 seconds = 5 minutes</span>
sudo hdparm -S <span class="m">60</span> /dev/disk/by-uuid/<span class="si">${</span><span class="nv">HDD_UUID</span><span class="si">}</span>
<span class="nb">echo</span> <span class="s2">&quot;/dev/disk/by-uuid/</span><span class="si">${</span><span class="nv">HDD_UUID</span><span class="si">}</span><span class="s2"> {</span>
<span class="s2">    spindown_time = 60</span>
<span class="s2">}&quot;</span> <span class="p">|</span> sudo tee -a /etc/hdparm.conf
</pre></div>


<h3>Monitoring solution</h3>
<p>I've been looking into a vast amount of tools to help me monitor and visualize the metrics I mentioned in my <a href="//blog.bjk.is/what-im-aiming-for.html">last post</a>. The list includes time series logging and graphing tools such as <a href="https://oss.oetiker.ch/rrdtool/">RRDtool</a> with <a href="https://collectd.org/">collectd</a> and <a href="http://manpages.ubuntu.com/manpages/xenial/en/man8/sensord.8.html">sensord</a> or <a href="http://grafana.org/">Grafana</a> with <a href="https://influxdata.com/">InfluxDB</a>.</p>
<p>However, I decided do make some compromises and accept that the server wouldn't be perfect in this first setup so I chose the easy-to-install, configure-free-out-of-the-box-experience <a href="https://my-netdata.io/">netdata</a>. There is actually a lot of configable options (the configuration file on my computer is 6656 lines!), but the idea with netdata is that it simply works out-of-the-box. I didn't change a thing and my dashboard looks like this:</p>
<p><img alt="My configure-free netdata dashboard" src="//blog.bjk.is/static/netdata_screenshot.png" /></p>
<p>Netdata runs in the background and monitors various metrics. Netdata is about <em>"real-time performance monitoring"</em> and doesn't write anyting to the disk. The default configuration is to keep metrics data for the last hour in memory and discard anything older than that. </p>
<p>On my NUC netdata uses around 30MiB of RAM and causes ~2% CPU load. Netdata serves its own web server on port 19999 that I open on my laptop on <code>http://localhost:19999</code> through an SSH tunnel brought up with <code>ssh -L 19999:127.0.0.1:19999 bjk.is</code> (bjk.is is an entry in my <code>~/.ssh/config</code> file).</p>
<p>There is much more data on the dashboard than I usually look at and sometimes I have to scroll very far down to see the numbers that I'm interested in. Even so, there are a few metrics I'd like to have and theoretically I could write add-ons to gather them (which I'll maybe do one day). At least I should edit the configuration file and cut off some metrics to clean up the clutter and lower the load.</p>
<p>I installed netdata by following the <a href="https://github.com/firehol/netdata/wiki/Installation">official instructions</a>. In a nutshell, it goes like this:</p>
<div class="highlight"><pre><span></span>sudo apt install zlib1g-dev uuid-dev libmnl-dev gcc make git autoconf autogen automake pkg-config
sudo git clone https://github.com/firehol/netdata.git --depth<span class="o">=</span><span class="m">1</span> /usr/src/netdata
<span class="nb">echo</span> <span class="s2">&quot;alias update-netdata=&#39;pushd /usr/src/netdata &amp;&amp; sudo git pull &amp;&amp; sudo ./netdata-installer.sh &amp;&amp; popd&#39;&quot;</span> &gt;&gt; ~/.bash_aliases
<span class="nb">source</span> ~/.bash_aliases
update-netdata
</pre></div>


<p>and then I can use the alias <code>update-netdata</code> when new versions emerge.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="//blog.bjk.is/tag/devops.html">DevOps</a>
      <a href="//blog.bjk.is/tag/infrastructure.html">infrastructure</a>
      <a href="//blog.bjk.is/tag/ubuntu.html">Ubuntu</a>
      <a href="//blog.bjk.is/tag/monitoring.html">monitoring</a>
      <a href="//blog.bjk.is/tag/netdata.html">netdata</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'blogbjkis';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
        <p>&copy; Bjarni Jens Kristinsson </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Server version 0.1 -- OS and monitoring",
  "headline": "Server version 0.1 -- OS and monitoring",
  "datePublished": "2016-05-29 00:00:00+00:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Bjarni Jens Kristinsson",
    "url": "//blog.bjk.is/author/bjarni-jens-kristinsson.html"
  },
  "image": "/static/bjk17.jpg ",
  "url": "//blog.bjk.is/server-version-01-os-and-monitoring.html",
  "description": "I chose to download and install Ubuntu Desktop 16.04 as there is no difference in the kernel versions and I needed the graphical DE anyway. The installation process is really easy and straight-forward. I chose to use the whole mSATA SSD under the OS with default LVM configuration. I ..."
}
</script></body>
</html>